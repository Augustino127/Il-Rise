<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IleRise - NASA Space Apps Challenge 2025</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/src/styles/game.css">
    <link rel="stylesheet" href="/src/styles/cursors.css">
    <link rel="stylesheet" href="/src/styles/tutorial.css">
    <link rel="stylesheet" href="/src/styles/location.css">
    <link rel="stylesheet" href="/src/styles/farm-v3.css">
</head>
<body style="background: radial-gradient(ellipse at center, #B8E6F5 0%, #87CEEB 50%, #A8D5A3 100%);">
    <!-- ========== ÉCRAN D'ACCUEIL ========== -->
    <div id="screen-home" class="screen active">
        <div class="home-container">
            <div class="logo-container">
                <div class="logo-icon">🌍</div>
                <h1 class="logo-title">IleRise</h1>
                <p class="logo-subtitle">AgroData Explorer</p>
            </div>

            <div class="hero-text">
                <p class="hero-message" data-i18n="home.heroMessage">
                    Sauvez AgriVerse avec les données NASA
                </p>
            </div>

            <div class="player-stats">
                <div class="stat-item">
                    <span class="stat-icon">❤️</span>
                    <span class="stat-value" id="home-lives">5</span>
                    <span class="stat-label" data-i18n="home.lives">Vies</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">💰</span>
                    <span class="stat-value" id="home-coins">0</span>
                    <span class="stat-label" data-i18n="home.coins">Pièces</span>
                </div>
            </div>

            <div class="home-menu-buttons">
                <button class="btn-primary btn-large" id="btn-start" data-i18n="home.btnStart">
                    🚀 Commencer
                </button>

                <button class="btn-secondary" id="btn-tutorial" data-i18n="home.btnTutorial">
                    🎓 Tutoriel Interactif
                </button>

                <button class="btn-secondary" id="btn-profile" data-i18n="home.btnProfile">
                    👤 Mon Profil
                </button>

                <button class="btn-secondary" id="btn-logout" data-i18n="home.btnLogout">
                    🚪 Se déconnecter
                </button>
            </div>

            <!-- Sélecteur de langue sur l'écran d'accueil -->
            <div id="language-switcher-home" class="language-switcher-home"></div>

            <div class="nasa-credit">
                <p>🛰️ Powered by NASA Earth Data</p>
            </div>
        </div>
    </div>

    <!-- ========== SÉLECTION LOCALITÉ ========== -->
    <div id="screen-location" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-location" data-i18n="common.back">← Retour</button>
            <h2 data-i18n="location.title">📍 Choisissez votre localité</h2>
        </div>

        <div class="location-info">
            <p data-i18n="location.subtitle">Sélectionnez une ville du Bénin pour charger les données satellites NASA</p>
            <p class="location-hint" data-i18n="location.hint">💡 Les conditions climatiques varient selon les régions</p>
        </div>

        <!-- Carte interactive -->
        <div class="satellite-map-container">
            <div id="satellite-map" class="satellite-map"></div>
        </div>

        <!-- Info ville sélectionnée -->
        <div class="location-selected" id="location-selected" style="display:none;">
            <div class="selected-header">
                <h3 id="selected-city-name">Parakou</h3>
                <span class="status-badge" id="selected-status">🟢 Bonne végétation</span>
            </div>

            <div class="location-stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">🌱</span>
                    <div class="stat-details">
                        <span class="stat-label" data-i18n="location.ndvi">NDVI</span>
                        <span class="stat-value" id="selected-ndvi">0.31</span>
                    </div>
                </div>

                <div class="stat-card">
                    <span class="stat-icon">🌡️</span>
                    <div class="stat-details">
                        <span class="stat-label" data-i18n="location.temperature">Température</span>
                        <span class="stat-value" id="selected-temp">28°C</span>
                    </div>
                </div>

                <div class="stat-card">
                    <span class="stat-icon">💧</span>
                    <div class="stat-details">
                        <span class="stat-label" data-i18n="location.soilMoisture">Humidité Sol</span>
                        <span class="stat-value" id="selected-moisture">18%</span>
                    </div>
                </div>

                <div class="stat-card">
                    <span class="stat-icon">🌧️</span>
                    <div class="stat-details">
                        <span class="stat-label" data-i18n="location.precipitation">Précipitations</span>
                        <span class="stat-value" id="selected-precip">120 mm</span>
                    </div>
                </div>
            </div>

            <button class="btn-primary btn-large" id="btn-confirm-location" data-i18n="location.btnConfirm">
                Confirmer et Choisir Culture
            </button>
        </div>
    </div>

    <!-- ========== SÉLECTION CULTURE ========== -->
    <div id="screen-crop-select" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-crop" data-i18n="common.back">← Retour</button>
            <h2 data-i18n="cropSelect.title">Choisissez votre culture</h2>
            <div class="player-coins">
                💰 <span id="crop-coins">0</span>
            </div>
        </div>

        <!-- Bouton Cartes Éducatives -->
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn-primary btn-large" id="btn-knowledge-cards" data-i18n="cropSelect.btnKnowledgeCards" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                📚 Cartes Éducatives NASA
            </button>
        </div>

        <!-- Bouton Ferme Interactive -->
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn-success btn-large" id="btn-farm-from-crop-select" style="border: none;">
                <span class="icon">🌾</span>
                <span class="text">Mode Ferme Interactive</span>
            </button>
        </div>

        <div class="crop-grid" id="crop-grid">
            <!-- Généré dynamiquement -->
        </div>
    </div>

    <!-- ========== SÉLECTION NIVEAU ========== -->
    <div id="screen-level-select" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-level" data-i18n="common.back">← Retour</button>
            <h2 id="level-crop-title">🌽 Maïs</h2>
            <div class="player-coins">
                💰 <span id="level-coins">0</span>
            </div>
        </div>

        <div class="level-info">
            <p class="level-description" id="level-crop-description" data-i18n="levelSelect.description">
                Progressez à travers 3 niveaux de difficulté croissante
            </p>
        </div>

        <div class="level-grid" id="level-grid">
            <!-- Généré dynamiquement -->
        </div>
    </div>

    <!-- ========== ÉCRAN DE JEU ========== -->
    <div id="screen-game" class="screen">
        <!-- En-tête jeu -->
        <div class="game-header">
            <button class="btn-back" id="btn-back-game">← Quitter</button>

            <div class="game-info">
                <div class="crop-badge">
                    <span id="game-crop-emoji">🌽</span>
                    <span id="game-crop-name">Maïs</span>
                    <span class="level-badge" id="game-level-badge">Niveau 1</span>
                </div>
                <button class="btn-location-indicator" id="btn-change-location" title="Changer de localité">
                    📍 <span id="current-location-name">Parakou</span>
                </button>
            </div>

            <div class="game-stats">
                <div class="stat">❤️ <span id="game-lives">5</span></div>
                <div class="stat">💰 <span id="game-coins">0</span></div>
            </div>
        </div>

        <!-- Conteneur principal avec layout amélioré -->
        <div class="game-main-layout">

            <!-- Colonne gauche: Visualisation 3D -->
            <div class="game-left-column">
                <div class="canvas-wrapper">
                    <div class="loading-overlay" id="canvas-loading">
                        <div class="spinner"></div>
                        <p>Chargement de votre champ...</p>
                    </div>
                    <div id="game-canvas-container">
                        <!-- Canvas Three.js injecté ici -->
                    </div>
                </div>

                <!-- Données Terrain Actuelles (compact) -->
                <div class="field-status-compact">
                    <div class="status-item">
                        <span class="icon">🌡️</span>
                        <div class="status-info">
                            <span class="value" id="nasa-temp">30°C</span>
                            <span class="label">Température</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="icon">💧</span>
                        <div class="status-info">
                            <span class="value" id="nasa-moisture">20%</span>
                            <span class="label">Humidité</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="icon">🌱</span>
                        <div class="status-info">
                            <span class="value" id="nasa-ndvi">0.3</span>
                            <span class="label">Santé des plantes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Colonne droite: Contrôles et objectif -->
            <div class="game-right-column">

                <!-- Objectif -->
                <div class="objective-card">
                    <h3>🎯 Objectif</h3>
                    <div class="target-value">
                        <span id="target-yield">3.0</span> <span class="unit">tonnes/hectare</span>
                    </div>
                    <p class="target-hint">Ajustez les paramètres pour atteindre cet objectif</p>
                    <p class="constraint-text" id="game-constraints"></p>
                </div>

                <!-- Curseurs de contrôle -->
                <div class="controls-card">
                    <h3>🎛️ Paramètres de Culture</h3>
                    <div id="cursor-container"></div>
                </div>

                <!-- Boutons d'action -->
                <div class="action-buttons-stack">
                    <button class="btn-secondary btn-icon" id="btn-recommendations">
                        <span class="icon">💡</span>
                        <span class="text">Aide NASA</span>
                    </button>
                    <button class="btn-primary btn-large" id="btn-simulate">
                        <span class="icon">🚀</span>
                        <span class="text">Lancer la Simulation</span>
                    </button>

                    <!-- Nouveau: Accès au Mode Ferme Interactive -->
                    <div class="mode-switch-divider">
                        <span class="divider-text">ou</span>
                    </div>
                    <button class="btn-success btn-large btn-farm-mode" id="btn-switch-farm-mode">
                        <span class="icon">🌾</span>
                        <span class="text">Mode Ferme Interactive</span>
                    </button>
                </div>

                <!-- Lien vers ajout de données (coming soon) -->
                <div class="coming-soon-card">
                    <p class="coming-soon-text">
                        <span class="badge-dev">En développement</span>
                    </p>
                    <button class="btn-tertiary btn-small" id="btn-add-data" disabled>
                        ➕ Ajouter mes propres données
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- ========== ÉCRAN RÉSULTATS ========== -->
    <div id="screen-results" class="screen">
        <div class="results-container">
            <div class="results-header">
                <h2 id="results-title">🎉 Niveau Réussi !</h2>
            </div>

            <div class="results-stars" id="results-stars">
                ⭐⭐⭐
            </div>

            <div class="results-score">
                <div class="score-main">
                    <span id="results-score-value">850</span>
                    <span class="score-max">/1000</span>
                </div>
                <p class="score-label">Score</p>
            </div>

            <!-- Comparaison Avant/Après -->
            <div class="comparison-view">
                <h3>📊 Évolution du Champ</h3>
                <div class="before-after">
                    <div class="comparison-col before">
                        <h4>AVANT</h4>
                        <div class="comparison-icon">🌱</div>
                        <div class="comparison-stats">
                            <div class="stat-row">
                                <span class="label">NDVI:</span>
                                <span class="value" id="before-ndvi">0.15</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Humidité:</span>
                                <span class="value" id="before-moisture">18%</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Hauteur:</span>
                                <span class="value" id="before-height">5cm</span>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-arrow">
                        <div class="arrow-icon">→</div>
                        <div class="days-label"><span id="simulation-days">90</span> jours</div>
                    </div>

                    <div class="comparison-col after">
                        <h4>APRÈS</h4>
                        <div class="comparison-icon">🌽</div>
                        <div class="comparison-stats">
                            <div class="stat-row">
                                <span class="label">NDVI:</span>
                                <span class="value" id="after-ndvi">0.78</span>
                                <span class="change positive" id="ndvi-change">+420%</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Humidité:</span>
                                <span class="value" id="after-moisture">32%</span>
                                <span class="change positive" id="moisture-change">+78%</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Hauteur:</span>
                                <span class="value" id="after-height">155cm</span>
                                <span class="change positive" id="height-change">+3000%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline de Simulation -->
            <div class="simulation-timeline">
                <h3>📅 Évolution sur <span id="timeline-duration">90</span> jours</h3>
                <div class="timeline-chart">
                    <canvas id="timeline-canvas" width="600" height="200"></canvas>
                </div>
                <div class="timeline-legend">
                    <div class="legend-item">
                        <span class="legend-color ndvi"></span>
                        <span>NDVI (Santé)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color moisture"></span>
                        <span>Humidité Sol</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color npk"></span>
                        <span>NPK</span>
                    </div>
                </div>
                <div class="timeline-events" id="timeline-events">
                    <!-- Événements injectés dynamiquement -->
                </div>
            </div>

            <div class="results-details">
                <div class="result-item">
                    <span class="result-label">🌾 Rendement</span>
                    <span class="result-value">
                        <span id="results-yield">4.2</span> t/ha
                    </span>
                </div>
                <div class="result-item">
                    <span class="result-label">🎯 Objectif</span>
                    <span class="result-value">
                        <span id="results-target">3.0</span> t/ha
                    </span>
                </div>
                <div class="result-item">
                    <span class="result-label">💰 Pièces gagnées</span>
                    <span class="result-value" id="results-coins">+100</span>
                </div>
            </div>

            <div class="results-diagnosis">
                <h3>📊 Diagnostic</h3>
                <div id="diagnosis-summary" class="diagnosis-summary"></div>
                <div id="diagnosis-details" class="diagnosis-details"></div>
            </div>

            <!-- Cartes Éducatives -->
            <div class="education-cards-section" id="education-cards-section">
                <h3>📚 Savais-tu que...?</h3>
                <div class="education-cards-container" id="education-cards-container">
                    <!-- Cartes injectées dynamiquement -->
                </div>
            </div>

            <div class="results-actions">
                <button class="btn-secondary" id="btn-retry">
                    🔄 Rejouer
                </button>
                <button class="btn-primary" id="btn-next-level">
                    ➡️ Niveau Suivant
                </button>
                <button class="btn-secondary" id="btn-main-menu">
                    🏠 Menu Principal
                </button>
            </div>
        </div>
    </div>

    <!-- ========== ÉCRAN FERME INTERACTIVE V3 ========== -->
    <div id="screen-farm-v3" class="screen">

        <!-- Header avec ressources -->
        <div class="farm-header">
            <div class="header-left">
                <button class="btn-back" id="btn-back-farm">← Retour au Jeu</button>
                <h1>🌾 IleRise Farm Interactive</h1>
            </div>
            <div class="header-center">
                <div class="time-display">
                    <span class="time-icon" id="weather-icon">☀️</span>
                    <span id="display-day">Jour 1</span>
                    <span id="display-time">06:00</span>
                    <span id="display-season" class="season-badge">Sèche</span>
                </div>
            </div>
            <div class="header-right">
                <div class="resources-bar">
                    <div class="resource-item">
                        <span class="resource-icon">💰</span>
                        <span class="resource-value" id="display-money">500</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">💧</span>
                        <span class="resource-value" id="display-water">1000L</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Layout principal 3 colonnes -->
        <div class="farm-main-layout">

            <!-- Colonne Gauche: Mini-map et Navigation -->
            <div class="farm-left-column">

                <!-- Mini-map parcelles -->
                <div class="card plots-minimap">
                    <h3>🗺️ Parcelles</h3>
                    <div class="plots-grid-mini">
                        <div class="plot-mini active" data-plot-id="1">
                            <span class="plot-icon" id="plot-icon-1">🌽</span>
                            <span class="plot-number">1</span>
                        </div>
                        <div class="plot-mini locked" data-plot-id="2">
                            <span class="plot-icon">🔒</span>
                            <span class="plot-number">2</span>
                        </div>
                        <div class="plot-mini locked" data-plot-id="3">
                            <span class="plot-icon">🔒</span>
                            <span class="plot-number">3</span>
                        </div>
                        <div class="plot-mini locked" data-plot-id="4">
                            <span class="plot-icon">🔒</span>
                            <span class="plot-number">4</span>
                        </div>
                    </div>
                </div>

                <!-- Navigation sections -->
                <div class="card navigation-menu">
                    <button class="nav-btn active" data-section="farm">
                        <span class="nav-icon">🌾</span>
                        <span class="nav-label">Ferme</span>
                    </button>
                    <button class="nav-btn" data-section="livestock">
                        <span class="nav-icon">🐔</span>
                        <span class="nav-label">Élevage</span>
                    </button>
                    <button class="nav-btn" data-section="market">
                        <span class="nav-icon">🏪</span>
                        <span class="nav-label">Marché</span>
                    </button>
                    <button class="nav-btn" data-section="stats">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label">Stats</span>
                    </button>
                </div>

                <!-- Inventaire rapide -->
                <div class="card inventory-quick">
                    <h4>📦 Inventaire</h4>
                    <div class="inventory-items">
                        <div class="inv-item">
                            <span>🌱 Graines</span>
                            <span id="inv-seeds-total">50</span>
                        </div>
                        <div class="inv-item">
                            <span>🧪 NPK</span>
                            <span id="inv-npk">50kg</span>
                        </div>
                        <div class="inv-item">
                            <span>💩 Compost</span>
                            <span id="inv-compost">100kg</span>
                        </div>
                        <div class="inv-item">
                            <span>🌾 Récoltes</span>
                            <span id="inv-harvest">0t</span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Colonne Centrale: Vue parcelle active -->
            <div class="farm-center-column">

                <!-- Section Ferme (active par défaut) -->
                <div class="section-content active" id="section-farm">

                    <!-- Sélection de culture -->
                    <div class="card crop-selection">
                        <h3>🌾 Culture à Planter</h3>
                        <select id="crop-select" class="crop-selector">
                            <option value="">-- Choisir une culture --</option>
                            <option value="maize">🌽 Maïs (90 jours)</option>
                            <option value="cowpea">🫘 Niébé (60 jours)</option>
                            <option value="rice">🍚 Riz (120 jours)</option>
                            <option value="cassava">🥔 Manioc (300 jours)</option>
                            <option value="cacao">🍫 Cacao (365 jours)</option>
                            <option value="cotton">☁️ Coton (150 jours)</option>
                        </select>
                        <p class="crop-hint">Sélectionnez une culture avant de planter</p>
                    </div>  

                    <!-- Info parcelle -->
                    <div class="card plot-info">
                        <div class="plot-header">
                            <h2>
                                <span id="active-plot-icon">🌽</span>
                                <span id="active-plot-name">Parcelle 1</span>
                            </h2>
                            <span class="plot-size" id="active-plot-size">100m²</span>
                        </div>

                        <div class="plot-status-grid">
                            <div class="status-col">
                                <div class="status-label">Culture</div>
                                <div class="status-value" id="plot-crop">Vide</div>
                            </div>
                            <div class="status-col">
                                <div class="status-label">Progression</div>
                                <div class="status-value" id="plot-progress">-</div>
                            </div>
                            <div class="status-col">
                                <div class="status-label">Santé</div>
                                <div class="status-value" id="plot-health">
                                    <span class="health-bar">
                                        <span class="health-fill" style="width: 100%"></span>
                                    </span>
                                    <span>100%</span>
                                </div>
                            </div>
                            <div class="status-col">
                                <div class="status-label">Stade</div>
                                <div class="status-value" id="plot-stage">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Visualisation parcelle 3D -->
                    <div class="card plot-visual">
                        <div class="plot-field-3d" id="farm-scene-container"></div>
                    </div>

                    <!-- État du sol -->
                    <div class="card soil-status">
                        <h3>🌍 État du Sol</h3>
                        <div class="soil-indicators">
                            <div class="soil-indicator">
                                <div class="indicator-header">
                                    <span>💧 Humidité</span>
                                    <span id="soil-moisture-value">75%</span>
                                </div>
                                <div class="indicator-bar">
                                    <div class="indicator-fill water" id="soil-moisture-fill" style="width: 75%"></div>
                                </div>
                            </div>
                            <div class="soil-indicator">
                                <div class="indicator-header">
                                    <span>🧪 NPK</span>
                                    <span id="soil-npk-value">60%</span>
                                </div>
                                <div class="indicator-bar">
                                    <div class="indicator-fill npk" id="soil-npk-fill" style="width: 60%"></div>
                                </div>
                            </div>
                            <div class="soil-indicator">
                                <div class="indicator-header">
                                    <span>⚗️ pH</span>
                                    <span id="soil-ph-value">6.5</span>
                                </div>
                                <div class="indicator-bar">
                                    <div class="indicator-fill ph" id="soil-ph-fill" style="width: 80%"></div>
                                </div>
                            </div>
                            <div class="soil-indicator">
                                <div class="indicator-header">
                                    <span>🌿 Mauvaises herbes</span>
                                    <span id="soil-weed-value">20%</span>
                                </div>
                                <div class="indicator-bar">
                                    <div class="indicator-fill weed" id="soil-weed-fill" style="width: 20%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Section Élevage -->
                <div class="section-content" id="section-livestock">
                    <div class="card">
                        <h2>🐔 Poulailler</h2>
                        <div id="livestock-content">
                            <p class="unlock-message">Débloquez le poulailler pour 100💰</p>
                            <button class="btn-primary" id="btn-unlock-coop">Débloquer Poulailler</button>
                        </div>
                    </div>
                </div>

                <!-- Section Marché -->
                <div class="section-content" id="section-market">
                    <div class="card">
                        <h2>🏪 Marché Agricole</h2>
                        <div class="market-tabs">
                            <button class="market-tab active" data-tab="buy">Acheter</button>
                            <button class="market-tab" data-tab="sell">Vendre</button>
                        </div>
                        <div id="market-content"></div>
                    </div>
                </div>

                <!-- Section Stats -->
                <div class="section-content" id="section-stats">
                    <div class="card">
                        <h2>📊 Statistiques</h2>
                        <div id="stats-content"></div>
                    </div>
                </div>

            </div>

            <!-- Colonne Droite: Actions et contrôles -->
            <div class="farm-right-column">

                <!-- Contrôles temps -->
                <div class="card time-controls">
                    <h3>⏰ Temps</h3>
                    <div class="speed-controls">
                        <button class="speed-btn" data-speed="1">1x</button>
                        <button class="speed-btn active" data-speed="2">2x</button>
                        <button class="speed-btn" data-speed="4">4x</button>
                        <button class="speed-btn" data-speed="8">8x</button>
                    </div>
                    <div class="time-actions">
                        <button class="btn-secondary btn-icon" id="btn-pause">
                            <span>⏸️</span> Pause
                        </button>
                        <button class="btn-primary btn-icon" id="btn-next-day">
                            <span>⏭️</span> Jour Suivant
                        </button>
                    </div>
                </div>

                <!-- Actions disponibles -->
                <div class="card actions-panel">
                    <h3>🎮 Actions</h3>
                    <div class="actions-grid" id="actions-grid">

                        <button class="action-btn" data-action="plow">
                            <span class="action-icon">🚜</span>
                            <span class="action-name">Labourer</span>
                            <span class="action-cost">20💰</span>
                            <span class="action-hotkey">L</span>
                        </button>

                        <button class="action-btn" data-action="plant">
                            <span class="action-icon">🌱</span>
                            <span class="action-name">Planter</span>
                            <span class="action-cost">Graines</span>
                            <span class="action-hotkey">S</span>
                        </button>

                        <button class="action-btn" data-action="water">
                            <span class="action-icon">💧</span>
                            <span class="action-name">Arroser</span>
                            <span class="action-cost">100L</span>
                            <span class="action-hotkey">W</span>
                        </button>

                        <button class="action-btn" data-action="fertilize_npk">
                            <span class="action-icon">🧪</span>
                            <span class="action-name">NPK</span>
                            <span class="action-cost">20kg</span>
                            <span class="action-hotkey">F</span>
                        </button>

                        <button class="action-btn" data-action="fertilize_organic">
                            <span class="action-icon">💩</span>
                            <span class="action-name">Compost</span>
                            <span class="action-cost">30kg</span>
                            <span class="action-hotkey">C</span>
                        </button>

                        <button class="action-btn" data-action="weed">
                            <span class="action-icon">🌿</span>
                            <span class="action-name">Désherber</span>
                            <span class="action-cost">10💰</span>
                            <span class="action-hotkey">D</span>
                        </button>

                        <button class="action-btn" data-action="spray_pesticide_natural">
                            <span class="action-icon">🪲</span>
                            <span class="action-name">Pesticide</span>
                            <span class="action-cost">2L</span>
                            <span class="action-hotkey">P</span>
                        </button>

                        <button class="action-btn" data-action="harvest">
                            <span class="action-icon">🌾</span>
                            <span class="action-name">Récolter</span>
                            <span class="action-cost">20💰</span>
                            <span class="action-hotkey">H</span>
                        </button>

                    </div>
                </div>

                <!-- Recommandations NASA -->
                <div class="card nasa-recommendations">
                    <h3>🛰️ Aide NASA</h3>
                    <div id="nasa-recommendations-content">
                        <p class="recommendation-item">
                            <span class="rec-icon">⚠️</span>
                            <span class="rec-text">Cliquez sur une action pour commencer</span>
                        </p>
                    </div>
                    <button class="btn-secondary btn-small" id="btn-refresh-nasa">
                        🔄 Actualiser données
                    </button>
                </div>

                <!-- Événements à venir -->
                <div class="card upcoming-events">
                    <h4>📅 Événements</h4>
                    <div id="events-list">
                        <div class="event-item">
                            <span class="event-day">-</span>
                            <span class="event-desc">Aucun événement</span>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <!-- ========== ÉCRAN PROFIL UTILISATEUR ========== -->
    <div id="screen-profile" class="screen">
        <div class="profile-container">
            <!-- En-tête Profil -->
            <div class="profile-header">
                <button class="btn-back" id="btn-back-profile">← Retour</button>
                <h2>Mon Profil</h2>
                <div class="profile-actions">
                    <button class="btn-secondary btn-small" id="btn-export-profile">
                        📥 Exporter
                    </button>
                </div>
            </div>

            <!-- Avatar et Info Utilisateur -->
            <div class="profile-user-card">
                <div class="profile-avatar" id="profile-avatar">
                    👤
                </div>
                <div class="profile-user-info">
                    <h3 class="profile-username" id="profile-username">Agriculteur IleRise</h3>
                    <p class="profile-level">Niveau <span id="profile-level">1</span> - <span id="profile-title">Débutant</span></p>
                </div>
            </div>

            <!-- Statistiques Globales -->
            <div class="profile-stats-grid">
                <div class="profile-stat-card">
                    <div class="stat-icon">🎮</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profile-games-played">0</div>
                        <div class="stat-label">Parties jouées</div>
                    </div>
                </div>

                <div class="profile-stat-card">
                    <div class="stat-icon">⭐</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profile-total-stars">0</div>
                        <div class="stat-label">Étoiles totales</div>
                    </div>
                </div>

                <div class="profile-stat-card">
                    <div class="stat-icon">❤️</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profile-lives">5</div>
                        <div class="stat-label">Vies restantes</div>
                    </div>
                </div>

                <div class="profile-stat-card">
                    <div class="stat-icon">💰</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profile-coins">0</div>
                        <div class="stat-label">Pièces</div>
                    </div>
                </div>
            </div>

            <!-- Graphique Radar des Compétences -->
            <div class="profile-competences-card">
                <h3>📊 Compétences Développées</h3>
                <div class="competences-radar-container">
                    <canvas id="competences-radar" width="400" height="400"></canvas>
                </div>
                <div class="competences-legend">
                    <div class="legend-item">
                        <span class="legend-dot" style="background: #4CAF50;"></span>
                        <span>Analyse Données NASA</span>
                        <strong id="comp-nasa">0%</strong>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot" style="background: #0B3D91;"></span>
                        <span>Gestion des Ressources</span>
                        <strong id="comp-resources">0%</strong>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot" style="background: #F39C12;"></span>
                        <span>Prise de Décision</span>
                        <strong id="comp-decision">0%</strong>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot" style="background: #E53935;"></span>
                        <span>Diagnostic Agricole</span>
                        <strong id="comp-diagnostic">0%</strong>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot" style="background: #9C27B0;"></span>
                        <span>Planification</span>
                        <strong id="comp-planning">0%</strong>
                    </div>
                </div>
            </div>

            <!-- Progression Globale -->
            <div class="profile-progress-card">
                <h3>🎯 Progression Globale</h3>
                <div class="global-progress">
                    <div class="progress-info">
                        <span>Complétion du jeu</span>
                        <strong id="global-completion">0%</strong>
                    </div>
                    <div id="global-progress-bar"></div>
                </div>
                <div class="unlock-status">
                    <div class="unlock-item">
                        <span>Cultures débloquées:</span>
                        <strong><span id="unlocked-crops">1</span> / <span id="total-crops">5</span></strong>
                    </div>
                    <div class="unlock-item">
                        <span>Niveaux complétés:</span>
                        <strong><span id="completed-levels">0</span> / <span id="total-levels">15</span></strong>
                    </div>
                </div>
            </div>

            <!-- Achievements Débloqués -->
            <div class="profile-achievements-card">
                <h3>🏆 Achievements Débloqués</h3>
                <div class="achievements-grid" id="achievements-grid">
                    <!-- Généré dynamiquement -->
                    <div class="achievement-item locked">
                        <div class="achievement-icon">🌱</div>
                        <div class="achievement-info">
                            <div class="achievement-name">Premier Pas</div>
                            <div class="achievement-desc">Compléter le premier niveau</div>
                        </div>
                    </div>
                    <div class="achievement-item locked">
                        <div class="achievement-icon">⭐</div>
                        <div class="achievement-info">
                            <div class="achievement-name">Étoile Filante</div>
                            <div class="achievement-desc">Obtenir 3 étoiles sur un niveau</div>
                        </div>
                    </div>
                    <div class="achievement-item locked">
                        <div class="achievement-icon">📡</div>
                        <div class="achievement-info">
                            <div class="achievement-name">Maître NASA</div>
                            <div class="achievement-desc">Utiliser 10 fois les recommandations NASA</div>
                        </div>
                    </div>
                    <div class="achievement-item locked">
                        <div class="achievement-icon">💯</div>
                        <div class="achievement-info">
                            <div class="achievement-name">Perfectionniste</div>
                            <div class="achievement-desc">Score parfait de 1000 points</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historique des Dernières Parties -->
            <div class="profile-history-card">
                <h3>📜 Historique des Parties</h3>
                <div class="history-list" id="history-list">
                    <!-- Généré dynamiquement -->
                    <div class="history-empty">
                        <p>Aucune partie jouée pour le moment</p>
                        <p class="text-secondary">Commencez à jouer pour voir votre historique ici</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== ÉCRAN CARTES ÉDUCATIVES ========== -->
    <div id="screen-knowledge" class="screen">
        <div class="knowledge-container">
            <!-- En-tête -->
            <div class="knowledge-header">
                <button class="btn-back" id="btn-back-knowledge">← Retour</button>
                <h2>📚 Cartes Éducatives</h2>
            </div>

            <!-- Filtres par compétence -->
            <div class="knowledge-filters">
                <button class="filter-btn active" data-competence="all">
                    🌍 Toutes
                </button>
                <button class="filter-btn" data-competence="water">
                    💧 Eau
                </button>
                <button class="filter-btn" data-competence="npk">
                    🌿 NPK
                </button>
                <button class="filter-btn" data-competence="soil">
                    🏞️ Sol
                </button>
                <button class="filter-btn" data-competence="rotation">
                    🔄 Rotation
                </button>
                <button class="filter-btn" data-competence="nasa">
                    🛰️ NASA
                </button>
            </div>

            <!-- Filtres par niveau -->
            <div class="knowledge-level-filters">
                <button class="level-filter-btn active" data-level="all">Tous niveaux</button>
                <button class="level-filter-btn" data-level="beginner">Débutant</button>
                <button class="level-filter-btn" data-level="intermediate">Intermédiaire</button>
                <button class="level-filter-btn" data-level="expert">Expert</button>
            </div>

            <!-- Grille de cartes -->
            <div class="knowledge-cards-grid" id="knowledge-cards-grid">
                <!-- Généré dynamiquement -->
            </div>
        </div>
    </div>

    <!-- ========== ÉCRAN CONNEXION ========== -->
    <div id="screen-auth" class="screen">
        <div class="auth-container">
            <div class="auth-card">
                <!-- Logo -->
                <div class="auth-logo">
                    <div class="logo-icon">🌍</div>
                    <h1>IleRise</h1>
                    <p>AgroData Explorer</p>
                </div>

                <!-- Tabs Login/Register -->
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Connexion</button>
                    <button class="auth-tab" data-tab="register">Inscription</button>
                </div>

                <!-- Formulaire Connexion -->
                <div id="auth-login" class="auth-form active">
                    <h2>Se connecter</h2>
                    <form id="form-login">
                        <div class="form-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" class="form-input" placeholder="votre@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Mot de passe</label>
                            <input type="password" id="login-password" class="form-input" placeholder="••••••••" required>
                        </div>
                        <div class="form-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="login-remember">
                                <span>Se souvenir de moi</span>
                            </label>
                            <a href="#" class="link-forgot">Mot de passe oublié ?</a>
                        </div>
                        <button type="submit" class="btn-primary btn-large btn-auth">
                            Se connecter
                        </button>
                    </form>
                    <div class="auth-divider">
                        <span>OU</span>
                    </div>
                    <button class="btn-secondary btn-large" id="btn-guest">
                        🎮 Continuer en invité
                    </button>
                </div>

                <!-- Formulaire Inscription -->
                <div id="auth-register" class="auth-form">
                    <h2>Créer un compte</h2>
                    <form id="form-register">
                        <div class="form-group">
                            <label for="register-username">Nom d'utilisateur</label>
                            <input type="text" id="register-username" class="form-input" placeholder="JohnDoe" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">Email</label>
                            <input type="email" id="register-email" class="form-input" placeholder="votre@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password">Mot de passe</label>
                            <input type="password" id="register-password" class="form-input" placeholder="••••••••" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="register-confirm">Confirmer le mot de passe</label>
                            <input type="password" id="register-confirm" class="form-input" placeholder="••••••••" required>
                        </div>
                        <div class="form-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="register-terms" required>
                                <span>J'accepte les <a href="#" class="link-terms">conditions d'utilisation</a></span>
                            </label>
                        </div>
                        <button type="submit" class="btn-primary btn-large btn-auth">
                            Créer mon compte
                        </button>
                    </form>
                </div>

                <!-- NASA Credit -->
                <div class="auth-footer">
                    <p>🛰️ Powered by NASA Earth Data</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL CARTE ÉDUCATIVE ========== -->
    <div id="modal-knowledge-card" class="modal">
        <div class="modal-content knowledge-modal">
            <button class="modal-close" id="btn-close-knowledge-card">✕</button>

            <!-- En-tête carte -->
            <div class="knowledge-card-header">
                <div class="card-competence-badge" id="modal-card-competence">💧 Eau</div>
                <div class="card-level-badge" id="modal-card-level">Débutant</div>
            </div>

            <!-- Titre -->
            <h2 class="knowledge-card-title" id="modal-card-title">Titre de la carte</h2>

            <!-- Image -->
            <div class="knowledge-card-image-container">
                <img id="modal-card-image" src="" alt="Illustration" class="knowledge-card-image">
            </div>

            <!-- Contenu -->
            <div class="knowledge-card-content" id="modal-card-content">
                Contenu de la carte...
            </div>

            <!-- Source NASA -->
            <div class="knowledge-card-source">
                <span class="source-icon">🛰️</span>
                <span id="modal-card-source">Source NASA</span>
            </div>

            <!-- Quiz -->
            <div class="knowledge-card-quiz" id="modal-card-quiz">
                <h3>🧠 Quiz</h3>
                <p class="quiz-question" id="quiz-question">Question?</p>
                <div class="quiz-answers" id="quiz-answers">
                    <!-- Généré dynamiquement -->
                </div>
                <div class="quiz-feedback" id="quiz-feedback" style="display: none;">
                    <!-- Feedback après réponse -->
                </div>
            </div>

            <!-- Navigation -->
            <div class="knowledge-card-nav">
                <button class="btn-secondary" id="btn-prev-card">← Précédent</button>
                <button class="btn-primary" id="btn-next-card">Suivant →</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DÉBLOCAGE ========== -->
    <div id="modal-unlock" class="modal">
        <div class="modal-content">
            <h2>🔒 Culture Verrouillée</h2>
            <div class="unlock-info">
                <div class="unlock-icon" id="unlock-crop-emoji">🌽</div>
                <h3 id="unlock-crop-name">Maïs</h3>
                <p class="unlock-cost">
                    Coût: <strong id="unlock-cost">100</strong> 💰
                </p>
                <p class="unlock-balance">
                    Vos pièces: <strong id="unlock-balance">50</strong> 💰
                </p>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="btn-cancel-unlock">Annuler</button>
                <button class="btn-primary" id="btn-confirm-unlock">Débloquer</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL RECOMMANDATIONS NASA ========== -->
    <div id="modal-recommendations" class="modal">
        <div class="modal-content large">
            <button class="modal-close" id="btn-close-recommendations">✕</button>
            <h2>💡 Recommandations Basées sur NASA</h2>
            <p class="modal-subtitle">Ajustez vos paramètres selon les données satellites</p>

            <div class="recommendation-cards">
                <div class="recommendation-card">
                    <div class="card-header">
                        <span class="card-icon">🌡️</span>
                        <h3>Analyse Température (MODIS)</h3>
                    </div>
                    <div class="card-body">
                        <div class="data-row">
                            <span class="label">Température actuelle:</span>
                            <span class="value" id="rec-temp-current">--°C</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Optimal pour cette culture:</span>
                            <span class="value" id="rec-temp-optimal">--°C</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Écart:</span>
                            <span class="value status" id="rec-temp-gap">--°C</span>
                        </div>
                        <div class="action-box" id="rec-temp-action">
                            ✅ Action recommandée : Analyse en cours...
                        </div>
                    </div>
                </div>

                <div class="recommendation-card">
                    <div class="card-header">
                        <span class="card-icon">💧</span>
                        <h3>Analyse Humidité Sol (SMAP)</h3>
                    </div>
                    <div class="card-body">
                        <div class="data-row">
                            <span class="label">Humidité actuelle:</span>
                            <span class="value" id="rec-moisture-current">--%</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Besoin de la culture:</span>
                            <span class="value" id="rec-moisture-optimal">--%</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Écart:</span>
                            <span class="value status" id="rec-moisture-gap">--%</span>
                        </div>
                        <div class="action-box" id="rec-moisture-action">
                            ✅ Action recommandée : Analyse en cours...
                        </div>
                        <div class="recommended-slider">
                            <label>Irrigation recommandée:</label>
                            <div class="slider-value" id="rec-irrigation-value">--</div>
                        </div>
                    </div>
                </div>

                <div class="recommendation-card">
                    <div class="card-header">
                        <span class="card-icon">🌾</span>
                        <h3>Analyse Végétation (NDVI)</h3>
                    </div>
                    <div class="card-body">
                        <div class="data-row">
                            <span class="label">NDVI actuel:</span>
                            <span class="value" id="rec-ndvi-current">--</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Statut:</span>
                            <span class="value status" id="rec-ndvi-status">--</span>
                        </div>
                        <div class="action-box" id="rec-ndvi-action">
                            ✅ Interprétation : Analyse en cours...
                        </div>
                    </div>
                </div>

                <div class="recommendation-card">
                    <div class="card-header">
                        <span class="card-icon">🌿</span>
                        <h3>Recommandation NPK</h3>
                    </div>
                    <div class="card-body">
                        <div class="data-row">
                            <span class="label">NPK optimal:</span>
                            <span class="value" id="rec-npk-optimal">-- kg/ha</span>
                        </div>
                        <div class="action-box" id="rec-npk-action">
                            ✅ Basé sur le stade de croissance et NDVI
                        </div>
                        <div class="recommended-slider">
                            <label>NPK recommandé:</label>
                            <div class="slider-value" id="rec-npk-value">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-secondary" id="btn-ignore-recommendations">
                    Ignorer
                </button>
                <button class="btn-primary" id="btn-apply-recommendations">
                    ✨ Appliquer Recommandations Auto
                </button>
            </div>
        </div>
    </div>

    <!-- ========== CHARGEMENT ========== -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Chargement données NASA...</p>
    </div>

    <!-- ========== INDICATEUR PROGRESSION SIMULATION ========== -->
    <div id="simulation-progress" class="simulation-progress" style="display: none;">
        <div class="simulation-progress-content">
            <h3>🌾 Simulation en cours...</h3>
            <p id="simulation-status">Initialisation de la simulation</p>

            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="simulation-progress-bar"></div>
            </div>

            <p class="progress-percentage">
                <span id="simulation-percentage">0</span>% -
                Jour <span id="simulation-day">0</span>/90
            </p>

            <div class="simulation-preview">
                <p id="simulation-phase">Phase: Germination</p>
                <p id="simulation-ndvi">NDVI: 0.00</p>
            </div>
        </div>
    </div>

    <!-- ========== MODAL GÉNÉRIQUE POUR MESSAGES ========== -->
    <div id="modal-message" class="modal">
        <div class="modal-content modal-message">
            <button class="modal-close" id="btn-close-message">✕</button>
            <div class="modal-message-icon" id="modal-message-icon">ℹ️</div>
            <h2 id="modal-message-title">Message</h2>
            <div class="modal-message-body" id="modal-message-body">
                Contenu du message
            </div>
            <div class="modal-message-actions">
                <button class="btn-primary" id="btn-message-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL CONFIRMATION ========== -->
    <div id="modal-confirm" class="modal">
        <div class="modal-content modal-confirm">
            <div class="modal-message-icon" id="modal-confirm-icon">❓</div>
            <h2 id="modal-confirm-title">Confirmation</h2>
            <div class="modal-message-body" id="modal-confirm-body">
                Êtes-vous sûr ?
            </div>
            <div class="modal-confirm-actions">
                <button class="btn-secondary" id="btn-confirm-cancel">Annuler</button>
                <button class="btn-primary" id="btn-confirm-ok">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="/src/app.js"></script>
</body>
</html>
