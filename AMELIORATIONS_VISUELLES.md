# üé® Am√©liorations Visuelles pour l'Affordance

## üéØ Objectif : Rendre le Jeu Intuitif et Visuel

Le public cible (agriculteurs africains) a besoin d'un jeu **visuellement parlant** o√π les actions et donn√©es sont **imm√©diatement compr√©hensibles**.

---

## ‚úÖ Fichiers Cr√©√©s

### 1. **nasa-soil-moisture-benin.json** ‚úÖ
**Localisation :** `public/data/nasa-soil-moisture-benin.json`

**Contenu :**
- Donn√©es SMAP r√©elles pour 11 villes du B√©nin
- Historique 30 jours d'humidit√© du sol
- Surface (0-5cm) et zone racinaire (0-100cm)
- Formats : volum√©trique (m¬≥/m¬≥) et pourcentage

**Utilisation :**
```javascript
const response = await fetch('/data/nasa-soil-moisture-benin.json');
const data = await response.json();

// Parakou
const parakou = data.layers.sm_surface.locations.find(
  loc => loc.city === 'Parakou'
);

console.log(parakou.current.percentage); // 21%
console.log(parakou.current.status); // "moderate"
```

---

### 2. **VisualEffects.js** ‚úÖ
**Localisation :** `src/3d/VisualEffects.js`

**Classe :** `VisualEffects`

**Effets disponibles :**

#### A. Effets M√©t√©o
- `createRainEffect()` - Pluie visuelle 3D
- `animateRain()` - Animation gouttes qui tombent
- `createHeatWaveEffect()` - Ciel jaune/soleil intense pour canicule

#### B. Sol Visuel
- `updateSoilMoisture()` - Couleur du sol selon humidit√©
- `addWaterIndicators()` - Gouttes d'eau visibles sur sol humide
- `createNutrientGrid()` - Texture sol selon NPK

#### C. Plantes Visuelles
- `addHealthGlow()` - Halo color√© selon NDVI (rouge‚Üíorange‚Üívert)
- `createGrowthBurst()` - Particules vertes lors de croissance

#### D. Affordance (Actions Claires)
- `addActionArrows()` - Fl√®ches anim√©es montrant o√π agir
- `createInfoPanel()` - Panneau 3D flottant avec texte
- `updateBillboards()` - Panneaux toujours face √† la cam√©ra

---

## üé® Am√©liorations Visuelles √† Impl√©menter

### 1. **SOL DYNAMIQUE** (PRIORIT√â 1)

#### Avant :
```
Sol statique brun, m√™me couleur toujours
```

#### Apr√®s :
```javascript
// Dans FarmScene.js
import { VisualEffects } from './VisualEffects.js';

class FarmScene {
  constructor(container) {
    // ...
    this.visualEffects = new VisualEffects(this.scene);
  }

  // Mettre √† jour selon humidit√© SMAP
  updateFromNASAData(nasaData) {
    const moisture = nasaData.soilMoisture.current_percent;

    // Couleur du sol
    this.visualEffects.updateSoilMoisture(moisture, this.ground);

    // Gouttes visuelles si humide
    if (moisture > 20) {
      this.visualEffects.addWaterIndicators(moisture);
    }

    // NPK texture
    const npk = this.currentNPK || 80;
    this.visualEffects.createNutrientGrid(this.ground, npk);
  }
}
```

**R√©sultat Visuel :**
- Sol SEC (10-15%) : Brun clair üü§
- Sol MOYEN (20-25%) : Brun moyen üü´ + quelques gouttes
- Sol HUMIDE (30-35%) : Brun fonc√© üü´ + beaucoup de gouttes üíß
- Sol SATUR√â (>35%) : Tr√®s fonc√© + flaques brillantes üí¶

---

### 2. **M√âT√âO VISUELLE** (PRIORIT√â 1)

#### Effet Pluie
```javascript
// Quand il pleut (donn√©es GPM > 10mm)
if (nasaData.precipitation.today_mm > 10) {
  this.visualEffects.createRainEffect(0.8); // Intensit√©
}

// Dans la boucle animate()
animate() {
  this.visualEffects.animateRain();
}
```

**R√©sultat :**
- Gouttes qui tombent du ciel üåßÔ∏è
- Plus de gouttes si pluie intense
- S'arr√™te quand sec ‚òÄÔ∏è

#### Effet Canicule
```javascript
// Si temp√©rature > 35¬∞C
if (nasaData.temperature.current_c > 35) {
  this.visualEffects.createHeatWaveEffect(
    nasaData.temperature.current_c
  );
}
```

**R√©sultat :**
- Ciel devient jaune-orang√© üåÖ
- Soleil plus intense (lumi√®re forte)
- Ambiance de chaleur visuelle

---

### 3. **SANT√â DES PLANTES VISUELLE** (PRIORIT√â 1)

#### NDVI Visuel avec Halo
```javascript
// Pour chaque plante
this.plants.forEach(plant => {
  const ndvi = nasaData.ndvi.current;
  this.visualEffects.addHealthGlow(plant, ndvi);
});
```

**R√©sultat :**
- NDVI < 0.3 : Halo ROUGE üî¥ (malade)
- NDVI 0.3-0.5 : Halo ORANGE üü† (moyen)
- NDVI 0.5-0.7 : Halo JAUNE-VERT üü° (bon)
- NDVI > 0.7 : Halo VERT BRILLANT üü¢ (excellent)

**L'agriculteur voit imm√©diatement la sant√© !**

---

### 4. **AFFORDANCE : FL√àCHES D'ACTION** (CRITIQUE)

#### Montrer o√π agir
```javascript
// Si sol sec
if (moisture < 20) {
  const arrow = this.visualEffects.addActionArrows(
    new THREE.Vector3(0, 0, 0),
    'water'
  );

  // Animer dans la boucle
  this.visualEffects.animateActionArrows(arrow, time);
}

// Si faible NPK
if (currentNPK < 60) {
  this.visualEffects.addActionArrows(
    new THREE.Vector3(2, 0, 0),
    'fertilize'
  );
}
```

**R√©sultat :**
- Fl√®ches BLEUES anim√©es ‚¨áÔ∏èüíß = "Arroser ici !"
- Fl√®ches ORANGE anim√©es ‚¨áÔ∏èüåø = "Fertiliser ici !"
- Fl√®ches VERTES anim√©es ‚¨áÔ∏èüåΩ = "R√©colter ici !"

**L'agriculteur sait quoi faire sans lire !**

---

### 5. **PANNEAUX D'INFO 3D FLOTTANTS** (PRIORIT√â 2)

#### Info contextuelle
```javascript
// Au survol d'une plante
onPlantHover(plant) {
  const info = this.visualEffects.createInfoPanel(
    `NDVI: ${plant.userData.ndvi.toFixed(2)}`,
    plant.position
  );

  setTimeout(() => {
    this.scene.remove(info);
  }, 3000);
}
```

**R√©sultat :**
- Panneau flottant au-dessus de la plante
- Toujours face √† la cam√©ra
- Texte clair et grand
- Dispara√Æt automatiquement

---

### 6. **ANIMATION DE CROISSANCE R√âALISTE** (PRIORIT√â 2)

#### Burst de particules lors de croissance
```javascript
// Quand plante grandit
onPlantGrow(plant) {
  const burst = this.visualEffects.createGrowthBurst(
    plant.position
  );
}

// Dans animate()
animate() {
  this.visualEffects.animateGrowthBursts(deltaTime);
}
```

**R√©sultat :**
- Particules vertes ‚ú® jaillissent de la plante
- Monte puis retombe (gravit√©)
- Fade out progressif
- Sensation de vie !

---

### 7. **SPLIT-SCREEN 3D AVANT/APR√àS** (CRITIQUE)

#### Double vue en temps r√©el
```html
<!-- Dans game.html -->
<div class="dual-3d-view">
  <div class="view-before">
    <h4>AVANT</h4>
    <div id="canvas-before"></div>
    <div class="snapshot-data">
      <div>NDVI: <span id="before-ndvi-3d">0.15</span></div>
      <div>Sol: <span id="before-soil-3d">Sec</span></div>
    </div>
  </div>

  <div class="view-arrow">‚Üí</div>

  <div class="view-after">
    <h4>APR√àS (PR√âVISION)</h4>
    <div id="canvas-after"></div>
    <div class="snapshot-data">
      <div>NDVI: <span id="after-ndvi-3d">0.78</span></div>
      <div>Sol: <span id="after-soil-3d">Optimal</span></div>
    </div>
  </div>
</div>
```

```javascript
// Cr√©er 2 sc√®nes
class DualSceneManager {
  constructor() {
    this.sceneBefore = new FarmScene(
      document.getElementById('canvas-before')
    );

    this.sceneAfter = new FarmScene(
      document.getElementById('canvas-after')
    );
  }

  setBeforeState(nasaData) {
    this.sceneBefore.updateFromNASAData(nasaData);
    this.sceneBefore.plantCrop('maize', 49);
  }

  predictAfterState(waterInput, npkInput, phInput) {
    // Simuler √©tat futur
    const predictedNDVI = 0.78;
    const predictedMoisture = 32;

    this.sceneAfter.visualEffects.addHealthGlow(
      this.sceneAfter.plants[0],
      predictedNDVI
    );

    this.sceneAfter.visualEffects.updateSoilMoisture(
      predictedMoisture,
      this.sceneAfter.ground
    );

    this.sceneAfter.plants.forEach(plant => {
      plant.scale.set(3, 3, 3); // Plantes matures
    });
  }
}
```

**R√©sultat :**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     AVANT       ‚îÇ  ‚Üí  ‚îÇ     APR√àS       ‚îÇ
‚îÇ                 ‚îÇ     ‚îÇ                 ‚îÇ
‚îÇ  üå± (petit)     ‚îÇ     ‚îÇ   üåΩ (grand)    ‚îÇ
‚îÇ  Sol clair      ‚îÇ     ‚îÇ   Sol fonc√©     ‚îÇ
‚îÇ  Halo rouge     ‚îÇ     ‚îÇ   Halo vert     ‚îÇ
‚îÇ  Sec            ‚îÇ     ‚îÇ   Humide        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 8. **INDICATEURS VISUELS DE CURSEURS** (PRIORIT√â 1)

#### Feedback temps r√©el en 3D
```javascript
// Quand curseur eau change
onWaterSliderChange(value) {
  // Montrer effet imm√©diatement
  if (value > 70) {
    this.visualEffects.createRainEffect(0.5);
  } else {
    this.visualEffects.stopRain();
  }

  // Changer couleur du sol
  const predictedMoisture = currentMoisture + (value / 2);
  this.visualEffects.updateSoilMoisture(
    predictedMoisture,
    this.ground
  );
}

// Quand curseur NPK change
onNPKSliderChange(value) {
  // Texture du sol change
  this.visualEffects.createNutrientGrid(this.ground, value);

  // Particules vertes si bon NPK
  if (value > 100) {
    this.plants.forEach(plant => {
      this.visualEffects.createGrowthBurst(plant.position);
    });
  }
}
```

**R√©sultat :**
- Curseur EAU ‚Üí Sol devient plus fonc√© en temps r√©el üíß
- Curseur NPK ‚Üí Sol devient plus riche, particules vertes ‚ú®
- Curseur pH ‚Üí Couleur des plantes change
- **L'agriculteur VOIT l'effet avant de simuler !**

---

### 9. **L√âGENDES VISUELLES** (PRIORIT√â 2)

#### Panneau de l√©gende permanent
```html
<div class="visual-legend">
  <h4>üé® L√©gende Visuelle</h4>

  <div class="legend-item">
    <div class="color-box" style="background: #8B7355"></div>
    <span>Sol Sec (< 20%)</span>
  </div>

  <div class="legend-item">
    <div class="color-box" style="background: #654321"></div>
    <span>Sol Humide (> 25%)</span>
  </div>

  <div class="legend-item">
    <div class="glow-demo red"></div>
    <span>NDVI Faible (< 0.3)</span>
  </div>

  <div class="legend-item">
    <div class="glow-demo green"></div>
    <span>NDVI Excellent (> 0.7)</span>
  </div>

  <div class="legend-item">
    <span>‚¨áÔ∏èüíß Fl√®che Bleue = Arroser</span>
  </div>

  <div class="legend-item">
    <span>‚¨áÔ∏èüåø Fl√®che Orange = Fertiliser</span>
  </div>
</div>
```

---

### 10. **SONS ET FEEDBACK AUDIO** (OPTIONNEL)

#### Sons correspondants aux actions
```javascript
class AudioFeedback {
  constructor() {
    this.sounds = {
      water: new Audio('/sounds/water-pour.mp3'),
      rain: new Audio('/sounds/rain.mp3'),
      grow: new Audio('/sounds/growth.mp3'),
      success: new Audio('/sounds/success.mp3')
    };
  }

  playWaterSound() {
    this.sounds.water.play();
  }

  playGrowthSound() {
    this.sounds.grow.play();
  }
}
```

---

## üéØ Plan d'Impl√©mentation Recommand√©

### Phase 1 : Effets Critiques (2-3h)
1. ‚úÖ Sol dynamique selon humidit√©
2. ‚úÖ Halo sant√© des plantes (NDVI)
3. ‚úÖ Fl√®ches d'action affordantes
4. ‚úÖ Pluie visuelle

### Phase 2 : Split-Screen (2h)
5. ‚úÖ Double vue 3D AVANT/APR√àS
6. ‚úÖ Pr√©diction visuelle temps r√©el

### Phase 3 : Polish (1-2h)
7. ‚úÖ Panneaux d'info flottants
8. ‚úÖ Particules de croissance
9. ‚úÖ L√©gende visuelle permanente
10. ‚è≥ Sons (optionnel)

---

## üìù Code d'Int√©gration dans FarmScene.js

```javascript
import { VisualEffects } from './VisualEffects.js';

export class FarmScene {
  constructor(container) {
    // ... code existant

    // NOUVEAU : Effets visuels
    this.visualEffects = new VisualEffects(this.scene);
    this.currentNASAData = null;
  }

  /**
   * NOUVEAU : Mettre √† jour depuis donn√©es NASA
   */
  updateFromNASAData(nasaData) {
    this.currentNASAData = nasaData;

    // Sol selon humidit√©
    const moisture = nasaData.soilMoisture?.current_percent || 20;
    this.visualEffects.updateSoilMoisture(moisture, this.ground);

    // Gouttes si humide
    if (moisture > 20) {
      this.visualEffects.addWaterIndicators(moisture);
    }

    // Pluie si pr√©cipitations
    if (nasaData.precipitation?.today_mm > 10) {
      this.visualEffects.createRainEffect(0.6);
    } else {
      this.visualEffects.stopRain();
    }

    // Canicule
    if (nasaData.temperature?.current_c > 35) {
      this.visualEffects.createHeatWaveEffect(
        nasaData.temperature.current_c
      );
    }

    // Sant√© plantes
    const ndvi = nasaData.ndvi?.current || 0.2;
    this.plants.forEach(plant => {
      this.visualEffects.addHealthGlow(plant, ndvi);
    });
  }

  /**
   * NOUVEAU : Afficher actions recommand√©es
   */
  showRecommendedActions(recommendations) {
    // Fl√®che eau si sec
    if (recommendations.moisture.irrigationRecommended > 50) {
      this.actionArrows = this.actionArrows || [];
      const arrow = this.visualEffects.addActionArrows(
        new THREE.Vector3(0, 0, 0),
        'water'
      );
      this.actionArrows.push(arrow);
    }

    // Fl√®che NPK si faible
    if (recommendations.npk.recommended > 100) {
      const arrow = this.visualEffects.addActionArrows(
        new THREE.Vector3(3, 0, 0),
        'fertilize'
      );
      this.actionArrows.push(arrow);
    }
  }

  /**
   * Boucle d'animation enrichie
   */
  animate() {
    requestAnimationFrame(() => this.animate());

    const time = Date.now() * 0.001;

    // Animer pluie
    this.visualEffects.animateRain();

    // Animer fl√®ches
    if (this.actionArrows) {
      this.actionArrows.forEach(arrow => {
        this.visualEffects.animateActionArrows(arrow, time);
      });
    }

    // Animer bursts
    this.visualEffects.animateGrowthBursts(0.016);

    // Billboards face cam√©ra
    this.visualEffects.updateBillboards(this.camera);

    this.controls.update();
    this.renderer.render(this.scene, this.camera);
  }
}
```

---

## ‚úÖ R√©sultat Final Attendu

### Ce que l'agriculteur verra :

1. **SOL VIVANT**
   - Change de couleur selon humidit√© üü§‚Üíüü´
   - Gouttes visibles si humide üíß
   - Texture selon NPK üåæ

2. **M√âT√âO R√âELLE**
   - Pluie qui tombe üåßÔ∏è
   - Ciel jaune si canicule üåÖ
   - Soleil intense ‚òÄÔ∏è

3. **PLANTES PARLANTES**
   - Halo rouge si malade üî¥
   - Halo vert si saine üü¢
   - Particules lors de croissance ‚ú®

4. **ACTIONS CLAIRES**
   - Fl√®ches bleues = Arroser ‚¨áÔ∏èüíß
   - Fl√®ches orange = Fertiliser ‚¨áÔ∏èüåø
   - Panneaux avec texte clair üìã

5. **COMPARAISON VISUELLE**
   - Vue AVANT : Petit, sec, rouge üå±
   - Vue APR√àS : Grand, humide, vert üåΩ
   - Diff√©rence √©vidente !

---

## üéâ Impact sur l'Affordance

### AVANT :
‚ùå Agriculteur ne comprend pas les chiffres
‚ùå Doit lire beaucoup de texte
‚ùå Ne sait pas quoi faire
‚ùå R√©sultat abstrait

### APR√àS :
‚úÖ Voit imm√©diatement l'√©tat du champ
‚úÖ Comprend visuellement la sant√©
‚úÖ Fl√®ches lui disent quoi faire
‚úÖ Voit la transformation avant/apr√®s

**Le jeu devient UNIVERSEL et INTUITIF !** üåç

---

**D√©velopp√© pour le NASA Space Apps Challenge 2025** üöÄ
